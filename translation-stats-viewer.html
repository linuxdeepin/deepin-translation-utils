<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepin Translation Statistics Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .upload-area {
            padding: 40px;
            text-align: center;
            border: 3px dashed #e0e0e0;
            margin: 30px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #4facfe;
            background: #f8f9ff;
        }

        .upload-area.drag-over {
            border-color: #4facfe;
            background: #f0f8ff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            color: #4facfe;
            margin-bottom: 20px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .stats-container {
            padding: 30px;
            display: none;
        }

        .overall-stats {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        .overall-stats h2 {
            font-size: 2em;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .load-new-file-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .load-new-file-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .file-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.85em;
            backdrop-filter: blur(10px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .finished { color: #4CAF50; }
        .unfinished { color: #FF9800; }
        .total { color: #2196F3; }
        .progress { color: #9C27B0; }

        .file-list {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }

        .file-list h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.5em;
        }

        .file-item {
            background: white;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .file-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .file-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .file-path {
            font-weight: 500;
            font-size: 1.1em;
        }

        .file-progress {
            font-size: 1.2em;
            font-weight: bold;
        }

        .file-details {
            padding: 20px;
            display: none;
            background: #fafafa;
        }

        .file-details.show {
            display: block;
        }

        .lang-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .lang-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }

        .lang-code {
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .lang-progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .lang-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }

        .lang-stats-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: #666;
        }

        .expand-icon {
            transition: transform 0.3s ease;
        }

        .expand-icon.rotated {
            transform: rotate(180deg);
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            border-left: 4px solid #c62828;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-container {
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 500;
            color: #333;
            font-size: 0.9em;
        }

        .filter-input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9em;
            transition: border-color 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .language-search-container {
            position: relative;
        }

        .language-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #4facfe;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
        }

        .language-option:hover {
            background: #f0f8ff;
        }

        .language-option:last-child {
            border-bottom: none;
        }

        .language-option.highlighted {
            background: #4facfe;
            color: white;
        }

        .clear-filters {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .clear-filters:hover {
            background: #d32f2f;
        }

        .view-switch {
            margin-bottom: 20px;
            text-align: center;
        }

        .view-switch-buttons {
            display: inline-flex;
            background: #f0f0f0;
            border-radius: 25px;
            padding: 4px;
            gap: 4px;
        }

        .view-switch-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            background: transparent;
            color: #666;
        }

        .view-switch-btn.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
        }

        .view-switch-btn:hover:not(.active) {
            background: #e0e0e0;
            color: #333;
        }

        /* è¯­è¨€åˆ‡æ¢æ ·å¼ */
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 5px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .language-toggle-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin: 0 2px;
        }

        .language-toggle-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-weight: 500;
        }

        .language-toggle-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .language-view {
            display: none;
        }

        .language-view.active {
            display: block;
        }

        .language-item {
            background: white;
            margin-bottom: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .language-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .language-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .language-header:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .language-title-section {
            text-align: left;
        }

        .language-code-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .language-code-subtitle {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .language-progress-section {
            text-align: right;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-progress-text {
            font-size: 1.3em;
            font-weight: bold;
        }

        .language-details {
            display: none;
            background: #fafafa;
        }

        .language-details.show {
            display: block;
        }

        .language-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            background: #f8f9fa;
            padding: 20px;
        }

        .language-stat {
            text-align: center;
        }

        .language-stat-number {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .language-stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .language-files {
            padding: 20px;
        }

        .language-file-item {
            background: #fafafa;
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
            transition: all 0.3s ease;
        }

        .language-file-item:hover {
            background: #f0f8ff;
            transform: translateX(5px);
        }

        .language-file-path {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .language-file-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #666;
        }

        .language-file-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mini-progress-bar {
            width: 80px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .mini-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .overall-stats {
                padding: 20px;
                padding-top: 60px; /* ä¸ºæŒ‰é’®ç•™å‡ºç©ºé—´ */
            }

            .load-new-file-btn {
                position: static;
                display: block;
                margin: 0 auto 20px auto;
                background: rgba(255, 255, 255, 0.9);
                color: #333;
                border-color: rgba(255, 255, 255, 0.8);
            }

            .file-info {
                position: static;
                display: block;
                margin: 0 auto 15px auto;
                text-align: center;
                max-width: 300px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
            }

            .file-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
            }

            .view-switch-buttons {
                flex-direction: column;
                width: 100%;
            }

            .view-switch-btn {
                width: 100%;
                margin: 2px 0;
            }

            .language-summary {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .language-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .language-title-section,
            .language-progress-section {
                text-align: center;
            }

            .language-code-title {
                font-size: 1.5em;
            }

            .language-file-stats {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .mini-progress-bar {
                width: 100%;
            }

            .language-toggle {
                position: static;
                margin: 0 auto 15px auto;
                display: flex;
                justify-content: center;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-toggle">
                <button class="language-toggle-btn active" onclick="switchLanguage('zh-CN')" id="lang-zh">ä¸­æ–‡</button>
                <button class="language-toggle-btn" onclick="switchLanguage('en')" id="lang-en">EN</button>
            </div>
            <h1 data-i18n="header.title">ğŸŒ Deepin Translation Statistics</h1>
            <p data-i18n="header.subtitle">åŠ è½½å¹¶æŸ¥çœ‹ç¿»è¯‘é¡¹ç›®çš„å®Œæˆæƒ…å†µç»Ÿè®¡</p>
        </div>

        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <h3 data-i18n="upload.title">ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½ JSON æ–‡ä»¶åˆ°æ­¤å¤„</h3>
            <p data-i18n="upload.description">æ”¯æŒ deepin-translation-utils ç”Ÿæˆçš„ç»Ÿè®¡æ–‡ä»¶</p>
            <button class="btn" onclick="document.getElementById('fileInput').click()" data-i18n="upload.button">é€‰æ‹©æ–‡ä»¶</button>
            <input type="file" id="fileInput" class="file-input" accept=".json" />
        </div>

        <div class="stats-container" id="statsContainer">
            <div class="overall-stats">
                <div class="file-info" id="fileInfo">
                    <!-- æ–‡ä»¶ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                <button class="load-new-file-btn" onclick="loadNewFile()" data-i18n="stats.load_new">
                    ğŸ“ åŠ è½½æ–°æ–‡ä»¶
                </button>
                <h2 data-i18n="stats.overall">ğŸ“Š æ€»ä½“ç»Ÿè®¡</h2>
                <div class="stats-grid" id="overallStats">
                    <!-- æ€»ä½“ç»Ÿè®¡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="view-switch">
                <div class="view-switch-buttons">
                    <button class="view-switch-btn active" onclick="switchView('file')" id="fileViewBtn" data-i18n="view.file_group">
                        ğŸ“ æŒ‰æ–‡ä»¶åˆ†ç»„
                    </button>
                    <button class="view-switch-btn" onclick="switchView('language')" id="languageViewBtn" data-i18n="view.language_group">
                        ğŸŒ æŒ‰è¯­è¨€åˆ†ç»„
                    </button>
                </div>
            </div>

            <div class="filter-container">
                <div class="filter-row">
                    <div class="filter-group">
                        <label data-i18n="filter.path">æ–‡ä»¶è·¯å¾„è¿‡æ»¤</label>
                        <input type="text" class="filter-input" id="pathFilter" data-i18n-placeholder="filter.path_placeholder" placeholder="è¾“å…¥æ–‡ä»¶è·¯å¾„å…³é”®è¯...">
                    </div>
                    <div class="filter-group">
                        <label data-i18n="filter.language">è¯­è¨€ä»£ç æœç´¢</label>
                        <div class="language-search-container">
                            <input type="text" class="filter-input" id="langFilter" data-i18n-placeholder="filter.language_placeholder" placeholder="è¾“å…¥è¯­è¨€ä»£ç æˆ–è¯­è¨€åç§°...">
                            <div class="language-dropdown" id="languageDropdown">
                                <!-- è¯­è¨€é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label data-i18n="filter.sort">æ’åºæ–¹å¼</label>
                        <select class="filter-input" id="sortOrder">
                            <option value="alphabetical" data-i18n="filter.sort_name">æŒ‰åç§°æ’åº</option>
                            <option value="progress" data-i18n="filter.sort_progress">æŒ‰å®Œæˆåº¦æ’åº</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label data-i18n="filter.calculation">è®¡ç®—æ¨¡å¼</label>
                        <select class="filter-input" id="calculationMode" onchange="switchCalculationMode()">
                            <option value="target" data-i18n="filter.target_based">åŸºäºç›®æ ‡è¯­è¨€æ¡ç›®</option>
                            <option value="source" data-i18n="filter.source_based">åŸºäºåŸè¯­è¨€æ¡ç›®</option>
                        </select>
                    </div>
                    <button class="clear-filters" onclick="clearFilters()" data-i18n="filter.clear">æ¸…é™¤è¿‡æ»¤</button>
                </div>
            </div>

            <div class="file-list" id="fileView">
                <h3 data-i18n="file.detailed_list">ğŸ“‹ è¯¦ç»†æ–‡ä»¶åˆ—è¡¨</h3>
                <div id="fileList">
                    <!-- æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="language-view" id="languageView">
                <h3 data-i18n="language.grouped_view">ğŸŒ æŒ‰è¯­è¨€åˆ†ç»„è§†å›¾</h3>
                <div id="languageList">
                    <!-- è¯­è¨€åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¯­è¨€åˆ‡æ¢å’Œå›½é™…åŒ–ç›¸å…³å˜é‡
        let currentLanguage = 'zh-CN'; // é»˜è®¤ä¸­æ–‡
        
        // ç¿»è¯‘å¯¹è±¡
        const translations = {
            'zh-CN': {
                'header.title': 'ğŸŒ Deepin Translation Statistics',
                'header.subtitle': 'åŠ è½½å¹¶æŸ¥çœ‹ç¿»è¯‘é¡¹ç›®çš„å®Œæˆæƒ…å†µç»Ÿè®¡',
                'upload.title': 'ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½ JSON æ–‡ä»¶åˆ°æ­¤å¤„',
                'upload.description': 'æ”¯æŒ deepin-translation-utils ç”Ÿæˆçš„ç»Ÿè®¡æ–‡ä»¶',
                'upload.button': 'é€‰æ‹©æ–‡ä»¶',
                'upload.loading': 'æ­£åœ¨å¤„ç†æ–‡ä»¶...',
                'upload.error': 'é”™è¯¯',
                'upload.restart': 'é‡æ–°å¼€å§‹',
                'upload.invalid': 'è¯·é€‰æ‹©ä¸€ä¸ªæœ‰æ•ˆçš„ JSON æ–‡ä»¶',
                'upload.parse_error': 'JSON æ–‡ä»¶è§£æå¤±è´¥: ',
                'stats.overall': 'ğŸ“Š æ€»ä½“ç»Ÿè®¡',
                'stats.load_new': 'ğŸ“ åŠ è½½æ–°æ–‡ä»¶',
                'stats.total_files': 'æ€»æ–‡ä»¶æ•°',
                'stats.finished_entries': 'å·²å®Œæˆæ¡ç›®',
                'stats.unfinished_entries': 'æœªå®Œæˆæ¡ç›®',
                'stats.overall_progress': 'æ€»ä½“è¿›åº¦',
                'stats.all_languages': '(æ‰€æœ‰è¯­è¨€)',
                'stats.target_based': '[ç›®æ ‡åŸºå‡†]',
                'stats.source_based': '[åŸæ–‡åŸºå‡†]',
                'view.file_group': 'ğŸ“ æŒ‰æ–‡ä»¶åˆ†ç»„',
                'view.language_group': 'ğŸŒ æŒ‰è¯­è¨€åˆ†ç»„',
                'filter.path': 'æ–‡ä»¶è·¯å¾„è¿‡æ»¤',
                'filter.path_placeholder': 'è¾“å…¥æ–‡ä»¶è·¯å¾„å…³é”®è¯...',
                'filter.language': 'è¯­è¨€ä»£ç æœç´¢',
                'filter.language_placeholder': 'è¾“å…¥è¯­è¨€ä»£ç æˆ–è¯­è¨€åç§°...',
                'filter.sort': 'æ’åºæ–¹å¼',
                'filter.sort_name': 'æŒ‰åç§°æ’åº',
                'filter.sort_progress': 'æŒ‰å®Œæˆåº¦æ’åº',
                'filter.calculation': 'è®¡ç®—æ¨¡å¼',
                'filter.target_based': 'åŸºäºç›®æ ‡è¯­è¨€æ¡ç›®',
                'filter.source_based': 'åŸºäºåŸè¯­è¨€æ¡ç›®',
                'filter.clear': 'æ¸…é™¤è¿‡æ»¤',
                'file.detailed_list': 'ğŸ“‹ è¯¦ç»†æ–‡ä»¶åˆ—è¡¨',
                'file.all_languages': ' (æ‰€æœ‰è¯­è¨€)',
                'file.finished': 'å·²å®Œæˆ',
                'file.unfinished': 'æœªå®Œæˆ',
                'file.progress': 'è¿›åº¦',
                'file.path': 'è·¯å¾„',
                'language.grouped_view': 'ğŸŒ æŒ‰è¯­è¨€åˆ†ç»„è§†å›¾',
                'language.files_count': 'ä¸ªç¿»è¯‘æ–‡ä»¶',
                'language.files': 'ç¿»è¯‘æ–‡ä»¶',
                'language.finished_entries': 'å·²å®Œæˆæ¡ç›®',
                'language.unfinished_entries': 'æœªå®Œæˆæ¡ç›®',
                'language.overall_progress': 'æ€»ä½“è¿›åº¦',
                'language.target_file': 'ç›®æ ‡æ–‡ä»¶',
                'time.loaded': 'ğŸ• åŠ è½½æ—¶é—´: '
            },
            'en': {
                'header.title': 'ğŸŒ Deepin Translation Statistics',
                'header.subtitle': 'Load and view translation project completion statistics',
                'upload.title': 'Click to select or drag JSON file here',
                'upload.description': 'Supports statistics files generated by deepin-translation-utils',
                'upload.button': 'Select File',
                'upload.loading': 'Processing file...',
                'upload.error': 'Error',
                'upload.restart': 'Start Over',
                'upload.invalid': 'Please select a valid JSON file',
                'upload.parse_error': 'JSON file parsing failed: ',
                'stats.overall': 'ğŸ“Š Overall Statistics',
                'stats.load_new': 'ğŸ“ Load New File',
                'stats.total_files': 'Total Files',
                'stats.finished_entries': 'Finished Entries',
                'stats.unfinished_entries': 'Unfinished Entries',
                'stats.overall_progress': 'Overall Progress',
                'stats.all_languages': '(All Languages)',
                'stats.target_based': '[Target Based]',
                'stats.source_based': '[Source Based]',
                'view.file_group': 'ğŸ“ Group by File',
                'view.language_group': 'ğŸŒ Group by Language',
                'filter.path': 'File Path Filter',
                'filter.path_placeholder': 'Enter file path keywords...',
                'filter.language': 'Language Code Search',
                'filter.language_placeholder': 'Enter language code or name...',
                'filter.sort': 'Sort Order',
                'filter.sort_name': 'Sort by Name',
                'filter.sort_progress': 'Sort by Progress',
                'filter.calculation': 'Calculation Mode',
                'filter.target_based': 'Based on Target Language Entries',
                'filter.source_based': 'Based on Source Language Entries',
                'filter.clear': 'Clear Filters',
                'file.detailed_list': 'ğŸ“‹ Detailed File List',
                'file.all_languages': ' (All Languages)',
                'file.finished': 'Finished',
                'file.unfinished': 'Unfinished',
                'file.progress': 'Progress',
                'file.path': 'Path',
                'language.grouped_view': 'ğŸŒ Language Grouped View',
                'language.files_count': ' translation files',
                'language.files': 'Translation Files',
                'language.finished_entries': 'Finished Entries',
                'language.unfinished_entries': 'Unfinished Entries',
                'language.overall_progress': 'Overall Progress',
                'language.target_file': 'Target File',
                'time.loaded': 'ğŸ• Load Time: '
            }
        };

        let translationData = null;
        let allLanguages = new Set();
        let currentView = 'file'; // 'file' or 'language'
        let currentFileName = '';
        let currentFileSize = 0;
        let languageOptions = []; // å­˜å‚¨è¯­è¨€é€‰é¡¹æ•°æ®
        let selectedLanguageFilter = '';
        let uploadEventHandlers = null; // å­˜å‚¨ä¸Šä¼ åŒºåŸŸçš„äº‹ä»¶å¤„ç†å™¨
        let calculationMode = 'target'; // 'target' æˆ– 'source' - è®¡ç®—æ¨¡å¼

        // å›½é™…åŒ–åŠŸèƒ½
        function t(key) {
            return translations[currentLanguage][key] || key;
        }

        function updatePageLanguage() {
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰ data-i18n å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = t(key);
            });

            // æ›´æ–° placeholder å±æ€§
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                element.placeholder = t(key);
            });

            // æ›´æ–°åŠ¨æ€å†…å®¹ï¼ˆå¦‚æœå·²ç»åŠ è½½äº†æ•°æ®ï¼‰
            if (translationData) {
                updateFileInfo();
                renderOverallStats();
                renderFileList();
                renderLanguageList();
            }
        }

        function switchLanguage(lang) {
            if (lang === currentLanguage) return;
            
            currentLanguage = lang;
            
            // ä¿å­˜åˆ° localStorage
            localStorage.setItem('language', lang);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('lang-zh').classList.toggle('active', lang === 'zh-CN');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            // æ›´æ–°é¡µé¢è¯­è¨€
            updatePageLanguage();
        }

        function detectBrowserLanguage() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„è¯­è¨€åå¥½
            const savedLang = localStorage.getItem('language');
            if (savedLang && translations[savedLang]) {
                return savedLang;
            }
            
            // æ£€æµ‹æµè§ˆå™¨è¯­è¨€
            const browserLang = navigator.language || navigator.userLanguage;
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä¸­æ–‡
            if (browserLang.startsWith('zh')) {
                return 'zh-CN';
            }
            
            // é»˜è®¤è¿”å›è‹±æ–‡
            return 'en';
        }

        // åˆå§‹åŒ–è¯­è¨€
        function initializeLanguage() {
            const detectedLang = detectBrowserLanguage();
            currentLanguage = detectedLang;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('lang-zh').classList.toggle('active', detectedLang === 'zh-CN');
            document.getElementById('lang-en').classList.toggle('active', detectedLang === 'en');
            
            // æ›´æ–°é¡µé¢è¯­è¨€
            updatePageLanguage();
        }

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const statsContainer = document.getElementById('statsContainer');

        // å®šä¹‰äº‹ä»¶å¤„ç†å™¨
        const dragOverHandler = (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        };

        const dragLeaveHandler = () => {
            uploadArea.classList.remove('drag-over');
        };

        const dropHandler = (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        };

        // å­˜å‚¨äº‹ä»¶å¤„ç†å™¨å¼•ç”¨
        uploadEventHandlers = {
            dragover: dragOverHandler,
            dragleave: dragLeaveHandler,
            drop: dropHandler
        };

        // åˆå§‹ç»‘å®šæ‹–æ‹½å¤„ç†
        uploadArea.addEventListener('dragover', dragOverHandler);
        uploadArea.addEventListener('dragleave', dragLeaveHandler);
        uploadArea.addEventListener('drop', dropHandler);

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // å¤„ç†æ–‡ä»¶
        function handleFile(file) {
            if (!file.name.endsWith('.json')) {
                showError(t('upload.invalid'));
                return;
            }

            // è®°å½•æ–‡ä»¶ä¿¡æ¯
            currentFileName = file.name;
            currentFileSize = file.size;

            showLoading();

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    translationData = JSON.parse(e.target.result);
                    processData();
                    showStats();
                } catch (error) {
                    showError(t('upload.parse_error') + error.message);
                }
            };
            reader.readAsText(file);
        }

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            uploadArea.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>${t('upload.loading')}</p>
                </div>
            `;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            uploadArea.innerHTML = `
                <div class="error-message">
                    <h3>âŒ ${t('upload.error')}</h3>
                    <p>${message}</p>
                    <button class="btn" onclick="loadNewFile()">${t('upload.restart')}</button>
                </div>
            `;
        }

        // å¤„ç†æ•°æ®
        function processData() {
            allLanguages.clear();
            languageOptions = [];
            
            // æ”¶é›†æ‰€æœ‰è¯­è¨€
            translationData.resource_groups.forEach(group => {
                group.target_lang_codes.forEach(lang => allLanguages.add(lang));
            });

            // å‡†å¤‡è¯­è¨€é€‰é¡¹æ•°æ®ï¼ˆåŒ…å«æ˜¾ç¤ºåç§°ï¼‰
            Array.from(allLanguages).forEach(langCode => {
                const displayName = getLanguageDisplayName(langCode);
                languageOptions.push({
                    code: langCode,
                    displayName: displayName,
                    searchText: `${displayName} ${langCode}`.toLowerCase()
                });
            });

            // è¯­è¨€æœç´¢åŠŸèƒ½å°†åœ¨showStatsä¸­è®¾ç½®
        }

        // è®¾ç½®è¯­è¨€æœç´¢åŠŸèƒ½
        function setupLanguageSearch() {
            const langFilter = document.getElementById('langFilter');
            const languageDropdown = document.getElementById('languageDropdown');
            
            if (!langFilter || !languageDropdown) {
                return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›
            }
            
            // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            langFilter.replaceWith(langFilter.cloneNode(true));
            const newLangFilter = document.getElementById('langFilter');
            
            let highlightedIndex = -1;

            // æœç´¢è¾“å…¥äº‹ä»¶
            newLangFilter.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                highlightedIndex = -1;
                
                if (searchTerm === '') {
                    selectedLanguageFilter = '';
                    languageDropdown.classList.remove('show');
                    // æ¸…ç©ºæœç´¢æ—¶é‡æ–°æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯
                    renderOverallStats();
                    renderFileList();
                    renderLanguageList();
                } else {
                    const filtered = languageOptions.filter(option => 
                        option.searchText.includes(searchTerm)
                    );
                    renderLanguageDropdown(filtered);
                    languageDropdown.classList.add('show');
                }
                
                applyFilters();
            });

            // é”®ç›˜å¯¼èˆª
            newLangFilter.addEventListener('keydown', (e) => {
                const options = languageDropdown.querySelectorAll('.language-option');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    highlightedIndex = Math.min(highlightedIndex + 1, options.length - 1);
                    updateHighlight(options);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    highlightedIndex = Math.max(highlightedIndex - 1, -1);
                    updateHighlight(options);
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (highlightedIndex >= 0 && options[highlightedIndex]) {
                        selectLanguageOption(options[highlightedIndex].dataset.langCode);
                    }
                } else if (e.key === 'Escape') {
                    languageDropdown.classList.remove('show');
                    highlightedIndex = -1;
                }
            });

            // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡†
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.language-search-container')) {
                    languageDropdown.classList.remove('show');
                    highlightedIndex = -1;
                }
            });
        }

        // æ¸²æŸ“è¯­è¨€ä¸‹æ‹‰é€‰é¡¹
        function renderLanguageDropdown(options) {
            const languageDropdown = document.getElementById('languageDropdown');
            languageDropdown.innerHTML = '';

            options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'language-option';
                div.dataset.langCode = option.code;
                div.textContent = option.displayName;
                div.addEventListener('click', () => selectLanguageOption(option.code));
                languageDropdown.appendChild(div);
            });
        }

        // æ›´æ–°é«˜äº®æ˜¾ç¤º
        function updateHighlight(options) {
            options.forEach((option, index) => {
                option.classList.toggle('highlighted', index === highlightedIndex);
            });
        }

        // é€‰æ‹©è¯­è¨€é€‰é¡¹
        function selectLanguageOption(langCode) {
            const langFilter = document.getElementById('langFilter');
            const languageDropdown = document.getElementById('languageDropdown');
            
            selectedLanguageFilter = langCode;
            const selectedOption = languageOptions.find(opt => opt.code === langCode);
            if (selectedOption && langFilter) {
                langFilter.value = selectedOption.displayName;
            }
            
            if (languageDropdown) {
                languageDropdown.classList.remove('show');
            }
            
            // é‡æ–°æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯å’Œåˆ—è¡¨ä»¥åæ˜ è¯­è¨€ç‰¹å®šçš„æ•°æ®
            renderOverallStats();
            renderFileList();
            renderLanguageList();
            applyFilters();
        }

        // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
        function showStats() {
            uploadArea.style.display = 'none';
            statsContainer.style.display = 'block';
            
            updateFileInfo();
            renderOverallStats();
            renderFileList();
            renderLanguageList();
            setupFilters();
            setupLanguageSearch();
        }

        // æ›´æ–°æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
        function updateFileInfo() {
            const fileInfoEl = document.getElementById('fileInfo');
            const fileSize = (currentFileSize / 1024).toFixed(1);
            const createTime = new Date().toLocaleString(currentLanguage === 'zh-CN' ? 'zh-CN' : 'en-US');
            
            fileInfoEl.innerHTML = `
                ğŸ“„ ${currentFileName} (${fileSize} KB)<br>
                ${t('time.loaded')}${createTime}
            `;
        }

        // æ¸²æŸ“æ€»ä½“ç»Ÿè®¡
        function renderOverallStats() {
            const stats = calculateOverallStats();
            const overallStatsEl = document.getElementById('overallStats');
            
            overallStatsEl.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number total">${stats.totalFiles}</div>
                    <div class="stat-label">${t('stats.total_files')}${stats.statsContext}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number finished">${stats.totalFinished}</div>
                    <div class="stat-label">${t('stats.finished_entries')}${stats.statsContext}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number unfinished">${stats.totalUnfinished}</div>
                    <div class="stat-label">${t('stats.unfinished_entries')}${stats.statsContext}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number progress">${stats.overallProgress}%</div>
                    <div class="stat-label">${t('stats.overall_progress')}${stats.statsContext}</div>
                </div>
            `;
        }

        // è®¡ç®—æ€»ä½“ç»Ÿè®¡ï¼ˆæ”¯æŒè¯­è¨€ç‰¹å®šç»Ÿè®¡å’Œè®¡ç®—æ¨¡å¼ï¼‰
        function calculateOverallStats() {
            let totalFiles = 0;
            let totalFinished = 0;
            let totalTargetItems = 0; // ç›®æ ‡è¯­è¨€æ¡ç›®æ€»æ•°
            let totalSourceItems = 0; // åŸè¯­è¨€æ¡ç›®æ€»æ•°
            let statsContext = '';

            translationData.resource_groups.forEach(group => {
                // ç»Ÿè®¡æ‰€æœ‰èµ„æºç»„çš„åŸè¯­è¨€æ¡ç›®
                const sourceTotal = group.source_stats.finished + group.source_stats.unfinished;
                
                // å¦‚æœæœ‰é€‰å®šçš„è¯­è¨€è¿‡æ»¤å™¨
                if (selectedLanguageFilter) {
                    // åªæœ‰å½“è¯¥èµ„æºç»„å­˜åœ¨é€‰å®šè¯­è¨€æ—¶æ‰ç»Ÿè®¡
                    if (group.target_stats && group.target_stats[selectedLanguageFilter]) {
                        totalFiles++;
                        const langStats = group.target_stats[selectedLanguageFilter].stats;
                        totalFinished += langStats.finished;
                        totalTargetItems += langStats.finished + langStats.unfinished;
                        totalSourceItems += sourceTotal;
                    }
                } else {
                    // ç»Ÿè®¡æ‰€æœ‰èµ„æºç»„ï¼ˆåŒ…æ‹¬æ²¡æœ‰ç›®æ ‡è¯­è¨€çš„ï¼‰
                    totalFiles++;
                    
                    // å¦‚æœæœ‰ç›®æ ‡è¯­è¨€ç»Ÿè®¡ï¼Œç´¯åŠ æ‰€æœ‰è¯­è¨€çš„å®Œæˆæ•°
                    if (group.target_lang_codes && group.target_lang_codes.length > 0) {
                        Object.values(group.target_stats).forEach(langStats => {
                            totalFinished += langStats.stats.finished;
                            totalTargetItems += langStats.stats.finished + langStats.stats.unfinished;
                        });
                        // åŸè¯­è¨€æ¡ç›®æ•°æŒ‰è¯­è¨€æ•°é‡è®¡ç®—
                        totalSourceItems += sourceTotal * Object.keys(group.target_stats).length;
                    } else {
                        // æ²¡æœ‰ç›®æ ‡è¯­è¨€çš„èµ„æºç»„ï¼Œè´¡çŒ®0å®Œæˆæ•°ï¼Œä½†è®¡å…¥åŸè¯­è¨€æ¡ç›®æ•°
                        totalSourceItems += sourceTotal;
                    }
                }
            });

            // è®¾ç½®æ˜¾ç¤ºä¸Šä¸‹æ–‡
            if (selectedLanguageFilter) {
                const selectedLangName = getLanguageDisplayName(selectedLanguageFilter);
                statsContext = ` (${selectedLangName})`;
            } else {
                statsContext = ` ${t('stats.all_languages')}`;
            }

            // æ ¹æ®è®¡ç®—æ¨¡å¼é€‰æ‹©åŸºå‡†
            const denominator = calculationMode === 'target' ? totalTargetItems : totalSourceItems;
            const overallProgress = denominator > 0 ? ((totalFinished / denominator) * 100).toFixed(2) : '0.00';

            return {
                totalFiles,
                totalFinished,
                totalUnfinished: denominator - totalFinished,
                overallProgress,
                statsContext: statsContext + ` ${calculationMode === 'target' ? t('stats.target_based') : t('stats.source_based')}`
            };
        }

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFileList() {
            const fileListEl = document.getElementById('fileList');
            fileListEl.innerHTML = '';

            // è·å–æ’åºæ–¹å¼
            const sortOrderEl = document.getElementById('sortOrder');
            const sortOrder = sortOrderEl ? sortOrderEl.value : 'alphabetical';
            
            // å‡†å¤‡æ•°æ®å¹¶æ’åº
            let fileData = translationData.resource_groups
                .filter(group => group.target_lang_codes.length > 0)
                .map(group => {
                    let totalFinished = 0;
                    let totalUnfinished = 0;
                    let progress = 0;
                    
                    // å¦‚æœæœ‰é€‰å®šçš„è¯­è¨€è¿‡æ»¤å™¨ï¼Œåªè®¡ç®—è¯¥è¯­è¨€çš„è¿›åº¦
                    if (selectedLanguageFilter && group.target_stats[selectedLanguageFilter]) {
                        const langStats = group.target_stats[selectedLanguageFilter].stats;
                        totalFinished = langStats.finished;
                        totalUnfinished = langStats.unfinished;
                    } else {
                        // å¦åˆ™è®¡ç®—æ‰€æœ‰è¯­è¨€çš„æ€»ä½“è¿›åº¦
                        Object.values(group.target_stats).forEach(langStats => {
                            totalFinished += langStats.stats.finished;
                            totalUnfinished += langStats.stats.unfinished;
                        });
                    }

                    // æ ¹æ®è®¡ç®—æ¨¡å¼é€‰æ‹©åŸºå‡†
                    const sourceTotal = group.source_stats.finished + group.source_stats.unfinished;
                    const targetTotal = totalFinished + totalUnfinished;
                    const denominator = calculationMode === 'target' ? targetTotal : sourceTotal;
                    progress = denominator > 0 ? ((totalFinished / denominator) * 100).toFixed(2) : '0.00';
                    
                    return { group, progress, totalFinished, totalUnfinished };
                });

            // æ’åº
            if (sortOrder === 'progress') {
                fileData.sort((a, b) => parseFloat(b.progress) - parseFloat(a.progress)); // æŒ‰è¿›åº¦é™åº
            } else {
                fileData.sort((a, b) => a.group.source_path.localeCompare(b.group.source_path)); // æŒ‰åç§°å‡åº
            }

            // æ¸²æŸ“
            fileData.forEach((item, index) => {
                const fileItem = createFileItem(item.group, index);
                fileListEl.appendChild(fileItem);
            });
        }

        // åˆ›å»ºæ–‡ä»¶é¡¹
        function createFileItem(group, index) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.dataset.sourcePath = group.source_path;

            // è®¡ç®—æ–‡ä»¶è¿›åº¦ï¼ˆæ”¯æŒè¯­è¨€ç‰¹å®šæ˜¾ç¤ºï¼‰
            let totalFinished = 0;
            let totalUnfinished = 0;
            let displayContext = '';
            
            // å¦‚æœæœ‰é€‰å®šçš„è¯­è¨€è¿‡æ»¤å™¨ï¼Œåªè®¡ç®—è¯¥è¯­è¨€çš„è¿›åº¦
            if (selectedLanguageFilter && group.target_stats[selectedLanguageFilter]) {
                const langStats = group.target_stats[selectedLanguageFilter].stats;
                totalFinished = langStats.finished;
                totalUnfinished = langStats.unfinished;
                const selectedLangName = getLanguageDisplayName(selectedLanguageFilter);
                displayContext = ` (${selectedLangName})`;
            } else {
                // å¦åˆ™è®¡ç®—æ‰€æœ‰è¯­è¨€çš„æ€»ä½“è¿›åº¦
                Object.values(group.target_stats).forEach(langStats => {
                    totalFinished += langStats.stats.finished;
                    totalUnfinished += langStats.stats.unfinished;
                });
                displayContext = t('file.all_languages');
            }

            // æ ¹æ®è®¡ç®—æ¨¡å¼é€‰æ‹©åŸºå‡†
            const sourceTotal = group.source_stats.finished + group.source_stats.unfinished;
            const targetTotal = totalFinished + totalUnfinished;
            const denominator = calculationMode === 'target' ? targetTotal : sourceTotal;
            const progress = denominator > 0 ? ((totalFinished / denominator) * 100).toFixed(2) : '0.00';

            fileItem.innerHTML = `
                <div class="file-header" onclick="toggleFileDetails(${index})">
                    <div class="file-path">${group.source_path}</div>
                    <div class="file-progress">
                        ${progress}%${displayContext}
                        <span class="expand-icon" id="icon-${index}">â–¼</span>
                    </div>
                </div>
                <div class="file-details" id="details-${index}">
                    <div class="lang-stats" id="langStats-${index}">
                        ${renderLanguageStats(group)}
                    </div>
                </div>
            `;

            return fileItem;
        }

        // æ¸²æŸ“è¯­è¨€ç»Ÿè®¡
        function renderLanguageStats(group) {
            let html = '';

            Object.entries(group.target_stats).forEach(([langCode, langData]) => {
                const stats = langData.stats;
                const total = stats.finished + stats.unfinished;
                const progress = total > 0 ? ((stats.finished / total) * 100).toFixed(2) : '0.00';

                html += `
                    <div class="lang-card">
                        <div class="lang-code">${langCode}</div>
                        <div class="lang-progress-bar">
                            <div class="lang-progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="lang-stats-text">
                            <span>${t('file.finished')}: ${stats.finished}</span>
                            <span>${t('file.unfinished')}: ${stats.unfinished}</span>
                            <span>${t('file.progress')}: ${progress}%</span>
                        </div>
                        <div style="font-size: 0.8em; color: #888; margin-top: 5px;">
                            ${t('file.path')}: ${langData.resource_path}
                        </div>
                    </div>
                `;
            });

            return html;
        }

        // åˆ‡æ¢æ–‡ä»¶è¯¦æƒ…æ˜¾ç¤º
        function toggleFileDetails(index) {
            const details = document.getElementById(`details-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            if (details.classList.contains('show')) {
                details.classList.remove('show');
                icon.classList.remove('rotated');
            } else {
                details.classList.add('show');
                icon.classList.add('rotated');
            }
        }

        // è®¾ç½®è¿‡æ»¤å™¨
        function setupFilters() {
            const pathFilter = document.getElementById('pathFilter');
            const sortOrder = document.getElementById('sortOrder');

            if (pathFilter) {
                pathFilter.addEventListener('input', applyFilters);
            }
            
            if (sortOrder) {
                sortOrder.addEventListener('change', () => {
                    renderFileList();
                    renderLanguageList();
                    applyFilters();
                });
            }
        }



        // æ¸…é™¤è¿‡æ»¤å™¨
        function clearFilters() {
            const pathFilter = document.getElementById('pathFilter');
            const langFilter = document.getElementById('langFilter');
            const sortOrder = document.getElementById('sortOrder');
            const calculationModeEl = document.getElementById('calculationMode');
            
            if (pathFilter) pathFilter.value = '';
            if (langFilter) langFilter.value = '';
            if (sortOrder) sortOrder.value = 'alphabetical';
            if (calculationModeEl) calculationModeEl.value = 'target';
            selectedLanguageFilter = '';
            calculationMode = 'target';
            
            // éšè—è¯­è¨€ä¸‹æ‹‰æ¡†
            const languageDropdown = document.getElementById('languageDropdown');
            if (languageDropdown) {
                languageDropdown.classList.remove('show');
            }
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨ï¼ˆåº”ç”¨é»˜è®¤æ’åºï¼‰ - ä»…åœ¨æœ‰æ•°æ®æ—¶
            if (translationData) {
                renderOverallStats();
                renderFileList();
                renderLanguageList();
                applyFilters();
            }
        }

        // è§†å›¾åˆ‡æ¢åŠŸèƒ½
        function switchView(viewType) {
            currentView = viewType;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('fileViewBtn').classList.toggle('active', viewType === 'file');
            document.getElementById('languageViewBtn').classList.toggle('active', viewType === 'language');
            
            // åˆ‡æ¢è§†å›¾æ˜¾ç¤º
            const fileView = document.getElementById('fileView');
            const languageView = document.getElementById('languageView');
            
            if (viewType === 'file') {
                fileView.style.display = 'block';
                languageView.classList.remove('active');
            } else {
                fileView.style.display = 'none';
                languageView.classList.add('active');
            }
            
            // åº”ç”¨å½“å‰è¿‡æ»¤å™¨
            applyFilters();
        }

        // åˆ‡æ¢è®¡ç®—æ¨¡å¼
        function switchCalculationMode() {
            const calculationModeEl = document.getElementById('calculationMode');
            calculationMode = calculationModeEl.value;
            
            // é‡æ–°æ¸²æŸ“ç»Ÿè®¡ä¿¡æ¯å’Œåˆ—è¡¨
            renderOverallStats();
            renderFileList();
            renderLanguageList();
            applyFilters();
        }

        // æ¸²æŸ“è¯­è¨€åˆ—è¡¨
        function renderLanguageList() {
            const languageListEl = document.getElementById('languageList');
            languageListEl.innerHTML = '';

            // æŒ‰è¯­è¨€åˆ†ç»„æ•°æ®
            const languageData = groupByLanguage();
            
            // è·å–æ’åºæ–¹å¼
            const sortOrderEl = document.getElementById('sortOrder');
            const sortOrder = sortOrderEl ? sortOrderEl.value : 'alphabetical';

            // å‡†å¤‡è¯­è¨€æ•°æ®å¹¶æ’åº
            let langArray = Array.from(allLanguages).map(langCode => {
                const data = languageData[langCode];
                if (!data) return null;
                
                // æ ¹æ®è®¡ç®—æ¨¡å¼é€‰æ‹©åŸºå‡†è®¡ç®—ç¿»è¯‘å®Œæˆåº¦
                const denominator = calculationMode === 'target' ? data.totalTargetItems : data.totalSourceItems;
                const progress = denominator > 0 ? 
                    ((data.totalFinished / denominator) * 100).toFixed(2) : '0.00';
                
                return { langCode, data, progress };
            }).filter(Boolean);

            // æ’åº
            if (sortOrder === 'progress') {
                langArray.sort((a, b) => parseFloat(b.progress) - parseFloat(a.progress)); // æŒ‰è¿›åº¦é™åº
            } else {
                langArray.sort((a, b) => {
                    const displayNameA = getLanguageDisplayName(a.langCode);
                    const displayNameB = getLanguageDisplayName(b.langCode);
                    return displayNameA.localeCompare(displayNameB);
                }); // æŒ‰æ˜¾ç¤ºåç§°å‡åº
            }

            // æ¸²æŸ“
            langArray.forEach((item, index) => {
                const languageItem = createLanguageItem(item.langCode, item.data, index);
                languageListEl.appendChild(languageItem);
            });
        }

        // æŒ‰è¯­è¨€åˆ†ç»„æ•°æ®
        function groupByLanguage() {
            const languageData = {};

            translationData.resource_groups.forEach(group => {
                Object.entries(group.target_stats).forEach(([langCode, langStats]) => {
                    if (!languageData[langCode]) {
                        languageData[langCode] = {
                            files: [],
                            totalFinished: 0,
                            totalUnfinished: 0,
                            totalFiles: 0
                        };
                    }

                    const stats = langStats.stats;
                    // æ ¹æ®è®¡ç®—æ¨¡å¼é€‰æ‹©åŸºå‡†
                    const sourceTotal = group.source_stats.finished + group.source_stats.unfinished;
                    const targetTotal = stats.finished + stats.unfinished;
                    const denominator = calculationMode === 'target' ? targetTotal : sourceTotal;
                    const progress = denominator > 0 ? ((stats.finished / denominator) * 100).toFixed(2) : '0.00';
                    
                    languageData[langCode].files.push({
                        sourcePath: group.source_path,
                        targetPath: langStats.resource_path,
                        finished: stats.finished,
                        unfinished: stats.unfinished,
                        sourceTotal: sourceTotal,
                        targetTotal: targetTotal,
                        progress: progress
                    });

                    languageData[langCode].totalFinished += stats.finished;
                    languageData[langCode].totalTargetItems = (languageData[langCode].totalTargetItems || 0) + targetTotal;
                    languageData[langCode].totalSourceItems = (languageData[langCode].totalSourceItems || 0) + sourceTotal;
                    
                    // æ ¹æ®è®¡ç®—æ¨¡å¼é€‰æ‹©åŸºå‡†æ¥è®¡ç®—æœªå®Œæˆæ•°
                    if (calculationMode === 'target') {
                        languageData[langCode].totalUnfinished = languageData[langCode].totalTargetItems - languageData[langCode].totalFinished;
                    } else {
                        languageData[langCode].totalUnfinished = languageData[langCode].totalSourceItems - languageData[langCode].totalFinished;
                    }
                    
                    languageData[langCode].totalFiles++;
                });
            });

            return languageData;
        }

        // è·å–è¯­è¨€æ˜¾ç¤ºåç§°
        function getLanguageDisplayName(langCode) {
            try {
                // å°†ä¸‹åˆ’çº¿è½¬æ¢ä¸ºè¿å­—ç¬¦
                const bcp47Code = langCode.replace('_', '-');
                // ä½¿ç”¨Intl.DisplayNamesè·å–è¯­è¨€åç§°
                const displayNames = new Intl.DisplayNames(['zh-CN'], {type: 'language'});
                const languageName = displayNames.of(bcp47Code);
                return `${languageName} (${langCode})`;
            } catch (error) {
                // å¦‚æœè·å–å¤±è´¥ï¼Œè¿”å›åŸå§‹ä»£ç 
                return langCode;
            }
        }

        // åˆ›å»ºè¯­è¨€é¡¹
        function createLanguageItem(langCode, langData, index) {
            const languageItem = document.createElement('div');
            languageItem.className = 'language-item';
            languageItem.dataset.languageCode = langCode;

            const total = langData.totalFinished + langData.totalUnfinished;
            const overallProgress = total > 0 ? ((langData.totalFinished / total) * 100).toFixed(2) : '0.00';
            const displayName = getLanguageDisplayName(langCode);
            
            languageItem.innerHTML = `
                <div class="language-header" onclick="toggleLanguageDetails(${index})">
                    <div class="language-title-section">
                        <div class="language-code-title">${displayName}</div>
                        <div class="language-code-subtitle">${langData.totalFiles} ${t('language.files_count')}</div>
                    </div>
                    <div class="language-progress-section">
                        <div class="language-progress-text">${overallProgress}%</div>
                        <span class="expand-icon" id="lang-icon-${index}">â–¼</span>
                    </div>
                </div>
                <div class="language-details" id="lang-details-${index}">
                    <div class="language-summary">
                        <div class="language-stat">
                            <div class="language-stat-number total">${langData.totalFiles}</div>
                            <div class="language-stat-label">${t('language.files')}</div>
                        </div>
                        <div class="language-stat">
                            <div class="language-stat-number finished">${langData.totalFinished}</div>
                            <div class="language-stat-label">${t('language.finished_entries')}</div>
                        </div>
                        <div class="language-stat">
                            <div class="language-stat-number unfinished">${langData.totalUnfinished}</div>
                            <div class="language-stat-label">${t('language.unfinished_entries')}</div>
                        </div>
                        <div class="language-stat">
                            <div class="language-stat-number progress">${overallProgress}%</div>
                            <div class="language-stat-label">${t('language.overall_progress')}</div>
                        </div>
                    </div>
                    <div class="language-files">
                        ${renderLanguageFiles(langData.files)}
                    </div>
                </div>
            `;

            return languageItem;
        }

        // æ¸²æŸ“è¯­è¨€æ–‡ä»¶åˆ—è¡¨
        function renderLanguageFiles(files) {
            return files.map(file => `
                <div class="language-file-item" data-source-path="${file.sourcePath}">
                    <div class="language-file-path">${file.sourcePath}</div>
                    <div class="language-file-stats">
                        <div class="language-file-progress">
                            <span>${t('file.finished')}: ${file.finished} | ${t('file.unfinished')}: ${file.unfinished}</span>
                            <div class="mini-progress-bar">
                                <div class="mini-progress-fill" style="width: ${file.progress}%"></div>
                            </div>
                            <span>${file.progress}%</span>
                        </div>
                    </div>
                    <div style="font-size: 0.8em; color: #888; margin-top: 5px;">
                        ${t('language.target_file')}: ${file.targetPath}
                    </div>
                </div>
            `).join('');
        }

        // åº”ç”¨è¿‡æ»¤å™¨
        function applyFilters() {
            if (currentView === 'file') {
                applyFileFilters();
            } else {
                applyLanguageFilters();
            }
        }

        // æ–‡ä»¶è§†å›¾è¿‡æ»¤å™¨
        function applyFileFilters() {
            const pathValue = document.getElementById('pathFilter').value.toLowerCase();
            const fileItems = document.querySelectorAll('.file-item');

            fileItems.forEach(item => {
                const sourcePath = item.dataset.sourcePath.toLowerCase();
                let shouldShow = true;

                // è·¯å¾„è¿‡æ»¤
                if (pathValue && !sourcePath.includes(pathValue)) {
                    shouldShow = false;
                }

                // è¯­è¨€è¿‡æ»¤
                if (selectedLanguageFilter && shouldShow) {
                    const group = translationData.resource_groups.find(g => 
                        g.source_path === item.dataset.sourcePath
                    );
                    if (!group || !group.target_lang_codes.includes(selectedLanguageFilter)) {
                        shouldShow = false;
                    }
                }

                item.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // è¯­è¨€è§†å›¾è¿‡æ»¤å™¨
        function applyLanguageFilters() {
            const pathValue = document.getElementById('pathFilter').value.toLowerCase();
            const languageItems = document.querySelectorAll('.language-item');

            languageItems.forEach(item => {
                const langCode = item.dataset.languageCode;
                let shouldShow = true;

                // è¯­è¨€è¿‡æ»¤
                if (selectedLanguageFilter && langCode !== selectedLanguageFilter) {
                    shouldShow = false;
                }

                if (shouldShow) {
                    // åœ¨è¯­è¨€é¡¹å†…éƒ¨åº”ç”¨æ–‡ä»¶è·¯å¾„è¿‡æ»¤
                    const fileItems = item.querySelectorAll('.language-file-item');
                    let hasVisibleFiles = false;

                    fileItems.forEach(fileItem => {
                        const sourcePath = fileItem.dataset.sourcePath.toLowerCase();
                        const fileShould = !pathValue || sourcePath.includes(pathValue);
                        fileItem.style.display = fileShould ? 'block' : 'none';
                        if (fileShould) hasVisibleFiles = true;
                    });

                    // å¦‚æœæ²¡æœ‰å¯è§çš„æ–‡ä»¶ï¼Œéšè—æ•´ä¸ªè¯­è¨€é¡¹
                    shouldShow = hasVisibleFiles;
                }

                item.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // åˆ‡æ¢è¯­è¨€è¯¦æƒ…æ˜¾ç¤º
        function toggleLanguageDetails(index) {
            const details = document.getElementById(`lang-details-${index}`);
            const icon = document.getElementById(`lang-icon-${index}`);
            
            if (details.classList.contains('show')) {
                details.classList.remove('show');
                icon.classList.remove('rotated');
            } else {
                details.classList.add('show');
                icon.classList.add('rotated');
            }
        }

        // åŠ è½½æ–°æ–‡ä»¶
        function loadNewFile() {
            // é‡ç½®çŠ¶æ€
            translationData = null;
            allLanguages.clear();
            currentView = 'file';
            currentFileName = '';
            currentFileSize = 0;
            languageOptions = [];
            selectedLanguageFilter = '';
            calculationMode = 'target';
            
            // å…ˆæ˜¾ç¤ºä¸Šä¼ ç•Œé¢
            statsContainer.style.display = 'none';
            uploadArea.style.display = 'block';
            
            // é‡ç½®è§†å›¾æŒ‰é’®çŠ¶æ€ (æ·»åŠ é”™è¯¯æ£€æŸ¥)
            const fileViewBtn = document.getElementById('fileViewBtn');
            const languageViewBtn = document.getElementById('languageViewBtn');
            if (fileViewBtn) fileViewBtn.classList.add('active');
            if (languageViewBtn) languageViewBtn.classList.remove('active');
            
            // é‡ç½®è¿‡æ»¤å™¨ (åœ¨ç•Œé¢åˆ‡æ¢å)
            clearFilters();
            
            // ç›´æ¥é‡ç½®å†…å®¹ï¼Œä¸éœ€è¦å…‹éš†
            uploadArea.innerHTML = `
                <div class="upload-icon">ğŸ“</div>
                <h3>${t('upload.title')}</h3>
                <p>${t('upload.description')}</p>
                <button class="btn" onclick="document.getElementById('fileInput').click()">${t('upload.button')}</button>
                <input type="file" id="fileInput" class="file-input" accept=".json" />
            `;
            
            // é‡æ–°ç»‘å®šæ–‡ä»¶è¾“å…¥äº‹ä»¶
            const newFileInput = document.getElementById('fileInput');
            if (newFileInput) {
                newFileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        handleFile(e.target.files[0]);
                    }
                });
            }
            
            // ç§»é™¤æ—§çš„æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨
            if (uploadEventHandlers) {
                uploadArea.removeEventListener('dragover', uploadEventHandlers.dragover);
                uploadArea.removeEventListener('dragleave', uploadEventHandlers.dragleave);
                uploadArea.removeEventListener('drop', uploadEventHandlers.drop);
            }
            
            // é‡æ–°ç»‘å®šæ‹–æ‹½äº‹ä»¶
            uploadArea.addEventListener('dragover', uploadEventHandlers.dragover);
            uploadArea.addEventListener('dragleave', uploadEventHandlers.dragleave);
            uploadArea.addEventListener('drop', uploadEventHandlers.drop);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–è¯­è¨€
        document.addEventListener('DOMContentLoaded', () => {
            initializeLanguage();
        });
    </script>
</body>
</html>